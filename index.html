<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Easy PACS by mehmetsen80</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Easy PACS</h1>
      <h2 class="project-tagline">The easiest way to store dicom files with a new open-source dicom listener for your PACS Server</h2>
      <a href="https://github.com/mehmetsen80/EasyPACS" class="btn">View on GitHub</a>
      <a href="https://github.com/mehmetsen80/EasyPACS/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/mehmetsen80/EasyPACS/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
<a id="welcome-to-easypacs" class="anchor" href="#welcome-to-easypacs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Welcome to EasyPACS.</h3>

<p>Easy PACS allows you to setup a PACS Server with online dicom viewer. It uses <a href="http://www.dcm4che.org/">dcm4che</a> API tools re-written with the latest frameworks such as Spring Boot and Gradle Build Environment. No need to setup a server anymore, the <em><strong>jar</strong></em> file is the file you only need and it already contains the web-server within. Thanks to Spring Boot, it enables the jar file to become both the listener (server) and web at the same time. </p>

<h3>
<a id="object-model" class="anchor" href="#object-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Object Model</h3>

<p>The server accepts all the dicom files and generates its entity data that is populated to relational database. The dicom entities are  <em><strong>Patient, Study, Series, Equipment and Instance</strong></em>.  They are reflected to your MYSQL database by the JPA Entity Manager. It converts the entities into re-usable object models. </p>

<h3>
<a id="infrastructure" class="anchor" href="#infrastructure" aria-hidden="true"><span class="octicon octicon-link"></span></a>Infrastructure</h3>

<p>Easy PACS uses several frameworks and platforms such as Spring Boot Framework, JPA/Hibernate, Thymeleaf and Gradle. The <a href="https://github.com/mehmetsen80/EasyPACS">source code</a> will inspire other developers as well in terms of using a compact platform with less code and maximum efficiency. Remember that both server and web is contained by one single jar file that makes setup very easy.</p>

<h3>
<a id="why-easypacs" class="anchor" href="#why-easypacs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why EasyPACS?</h3>

<p>Plenty of PACS servers exist in the market, so you might ask why another open-source PACS server? The PACS has right now $3 billion market size and they assume it will grow over $4 billion in 2018 with different archive models such as VNA (Vendor Neutral Archive). The problem is that the vendors charge too much mostly based on number of images just for standalone PACS servers.</p>

<h3>
<a id="solution" class="anchor" href="#solution" aria-hidden="true"><span class="octicon octicon-link"></span></a>Solution</h3>

<p>The health facilities need a cheaper PACS server along with the ability to customize the PACS according to their workflow logic. As experienced PACS developers, we have been working on several PACSs for years and all of them needed different  logic. Setting up a standalone PACS is usually not enough, especially not worth when it is very expensive. <em><strong>In short, we provide the cheapest and best customization of PACS solutions ever for the health organizations.</strong></em> </p>

<h3>
<a id="dicom-standards" class="anchor" href="#dicom-standards" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dicom Standards</h3>

<p>The standards of dicoms are specified by <a href="http://www.nema.org/">nema.org</a> an association for the need of medical standards. PACS is known Picture Archiving and Communication System and several PACSs run in the market which most of them look very similar. They all rely on the same dicom standards with different enterprise approaches. We are familiar with the standards of dicom files. So, we created the most robust and easiest dicom entity model for you.</p>

<h3>
<a id="database-is-mysql" class="anchor" href="#database-is-mysql" aria-hidden="true"><span class="octicon octicon-link"></span></a>Database is MYSQL</h3>

<p>We use MYSQL database for its flexibility and ease of usage. Please run the below sql queries to generate your data tables.</p>

<pre><code>CREATE TABLE tbl_patient (pkTBLPatientID BIGINT AUTO_INCREMENT NOT NULL, createdDate DATETIME, modifiedDate DATETIME, patientAge VARCHAR(10), patientBirthday DATE, patientID VARCHAR(100), patientName VARCHAR(100), patientSex VARCHAR(10), PRIMARY KEY (pkTBLPatientID))
CREATE TABLE tbl_study (pkTBLStudyID BIGINT AUTO_INCREMENT NOT NULL, accessionNumber VARCHAR(30), additionalPatientHistory VARCHAR(300), admittingDiagnosesDescription VARCHAR(200), createdDate DATETIME, modifiedDate DATETIME, referringPhysicianName VARCHAR(100), studyDateTime DATETIME, studyDescription VARCHAR(300), studyID VARCHAR(50), studyInstanceUID VARCHAR(100), studyPriorityID VARCHAR(40), studyStatusID VARCHAR(40), pkTBLPatientID BIGINT, PRIMARY KEY (pkTBLStudyID))
CREATE TABLE tbl_series (pkTBLSeriesID BIGINT AUTO_INCREMENT NOT NULL, bodyPartExamined VARCHAR(40), createdDate DATETIME, laterality VARCHAR(100), modifiedDate DATETIME, operatorsName VARCHAR(50), patientPosition VARCHAR(30), protocolName VARCHAR(100), seriesDateTime DATETIME, seriesDescription VARCHAR(100), seriesInstanceUID VARCHAR(100), seriesNumber INTEGER, pkTBLStudyID BIGINT, PRIMARY KEY (pkTBLSeriesID))
CREATE TABLE tbl_equipment (pkTBLEquipmentID BIGINT AUTO_INCREMENT NOT NULL, conversionType VARCHAR(50), createdDate DATETIME, deviceSerialNumber VARCHAR(100), institutionAddress VARCHAR(150), institutionName VARCHAR(100), institutionalDepartmentName VARCHAR(50), manufacturer VARCHAR(100), manufacturerModelName VARCHAR(100), modality VARCHAR(50), modifiedDate DATETIME, softwareVersion VARCHAR(100), stationName VARCHAR(60), pkTBLSeriesID BIGINT, PRIMARY KEY (pkTBLEquipmentID))
CREATE TABLE tbl_instance (pkTBLInstanceID BIGINT AUTO_INCREMENT NOT NULL, acquisitionDateTime DATETIME, contentDateTime DATETIME, createdDate DATETIME, exposureTime INTEGER, imageOrientation VARCHAR(40), imagePosition VARCHAR(80), imageType VARCHAR(40), instanceNumber INTEGER, kvp VARCHAR(40), mediaStorageSopInstanceUID VARCHAR(100), modifiedDate DATETIME, patientOrientation VARCHAR(40), pixelSpacing FLOAT, sliceLocation FLOAT, sliceThickness FLOAT, sopClassUID VARCHAR(100), sopInstanceUID VARCHAR(100), transferSyntaxUID VARCHAR(100), windowCenter VARCHAR(40), windowWidth VARCHAR(40), xrayTubeCurrent INTEGER, pkTBLSeriesID BIGINT, PRIMARY KEY (pkTBLInstanceID))
ALTER TABLE tbl_study ADD CONSTRAINT FK_tbl_study_pkTBLPatientID FOREIGN KEY (pkTBLPatientID) REFERENCES tbl_patient (pkTBLPatientID)
ALTER TABLE tbl_series ADD CONSTRAINT FK_tbl_series_pkTBLStudyID FOREIGN KEY (pkTBLStudyID) REFERENCES tbl_study (pkTBLStudyID)
ALTER TABLE tbl_equipment ADD CONSTRAINT FK_tbl_equipment_pkTBLSeriesID FOREIGN KEY (pkTBLSeriesID) REFERENCES tbl_series (pkTBLSeriesID)
ALTER TABLE tbl_instance ADD CONSTRAINT FK_tbl_instance_pkTBLSeriesID FOREIGN KEY (pkTBLSeriesID) REFERENCES tbl_series (pkTBLSeriesID)

</code></pre>

<h3>
<a id="dicom-entities" class="anchor" href="#dicom-entities" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dicom Entities</h3>

<p>The well known dicom standard is known as  <em><strong>Patient --&gt; NxStudy --&gt; MxSeries --&gt; ZxInstances</strong></em> . Normally, all these data types are contained per dicom file. So, it is up to the vendor how the dicom data is processed. We created an additional entity next to the Series called <em><strong>'Equipment'</strong></em> that shows the details of the modality being used by the dicom sender. The modality can be the CT, X-Ray or Ultrasound machine etc. Another important note is that <em><strong>Instance</strong></em> can be either the image or SR document. Here, we only use images, so we keep the <strong>instance</strong> as <strong>images</strong> on the server level.</p>

<p>Remember each dicom file keeps the hierarchy but is dependent on the vendor how to parse the file.</p>

<pre><code>Patient --&gt; NxStudy --&gt; MxSeries --&gt; ZxInstances 
Series --&gt; Equipment
1 Patient can contain N of Studies, 
1 Study can contain M of Series
1 Series can contain Z of Instances
1 Series can contain 1 Equipment
</code></pre>

<h3>
<a id="entity-diagram" class="anchor" href="#entity-diagram" aria-hidden="true"><span class="octicon octicon-link"></span></a>Entity Diagram</h3>

<p>The relationship between the entities is illustrated as below:</p>

<p><img src="https://2kere2beseder.files.wordpress.com/2015/04/easypacsorm_final.jpg" alt="Easy PACS Entity Diagram"></p>

<h3>
<a id="how-to-setup-java-environment" class="anchor" href="#how-to-setup-java-environment" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to Setup Java Environment</h3>

<p>Java platform is tricky. It uses 32 bit Java environment along with needed <em>**clib</em>**_ files to enable the image file conversions. Please download and copy paste the below clib files under your jdk folder.</p>

<ol>
<li>Put 32 bit  <a href="https://2kere2beseder.files.wordpress.com/2015/04/clib_files.zip">clib_jiio.dll, clib_jiio_sse2.dll, clib_jiio_util.dll</a> dll files under C:\Program Files (x86)\Java\jdk1.8.0_45\bin</li>
<li>Put <a href="https://2kere2beseder.files.wordpress.com/2015/04/clib_files.zip">clibwrapper_jiio.jar, jai_imageio.jar</a> jar files under  C:\Program Files (x86)\Java\jdk1.8.0_45\jre\lib\ext\</li>
</ol>

<h3>
<a id="environmental-variables" class="anchor" href="#environmental-variables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Environmental Variables:</h3>

<p>Make sure that your Java Environmental Variables are setup correctly</p>

<pre><code>User Defined
Variable Name:  JAVA_HOME
Variable Value: C:\Program Files (x86)\Java\jdk1.8.0_45
</code></pre>

<pre><code>System variables
Variable Name:  CLASSPATH
Variable Value: %JAVA_HOME%\jre\bin
</code></pre>

<h3>
<a id="lets-download--run-our-jar-file" class="anchor" href="#lets-download--run-our-jar-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Let's Download &amp; run our jar file!</h3>

<p>First download the folder template <a href="https://s3-us-west-2.amazonaws.com/easypacs/EasyPACS.zip">EasyPACS.zip</a> file. It contains <em><strong>tmp</strong></em> directory that stores the dicom and image files. It also contains 2 files; <em><strong>application.properties</strong></em> and <em><strong>easy.pacs-0.0.1-SNAPSHOT.jar</strong></em> files. Please replace the jar file with latest version<a href="https://s3-us-west-2.amazonaws.com/easypacs/easy.pacs-0.0.1-SNAPSHOT.jar">version</a>. </p>

<h3>
<a id="applicationproperties" class="anchor" href="#applicationproperties" aria-hidden="true"><span class="octicon octicon-link"></span></a>application.properties</h3>

<p>Please follow the below instructions to modify your application.properties file. Update your MYSQL connection string <strong>username</strong>, <strong>password</strong> and <strong>url</strong> address. Please replace <strong>localhost</strong> with your <strong>ip address</strong> if needed.</p>

<pre><code>datasource.primary.url=jdbc:mysql://localhost:3306/dbdicom
datasource.primary.username=[username]
datasource.primary.password=[password]
</code></pre>

<p>Change PACS port number if needed (make sure port 104 is not being used) Your dicom PACS server will listen this port</p>

<pre><code>pacs.ports = 104
</code></pre>

<p>You can also update your ae title. Here we put <strong>'*'</strong> that refers to any name of ae title</p>

<pre><code>pacs.aetitle = *
</code></pre>

<p>Likewise, you can change the dicom and image storage paths if needed</p>

<pre><code>pacs.storage.dcm = ./tmp/dcm
pacs.storage.image = ./tmp/img
</code></pre>

<p>You can also update your web server's port. You will access your server from <em><strong>http://localhost:8085</strong></em></p>

<pre><code>server.port=8085 
</code></pre>

<h3>
<a id="now-we-are-finished-with-our-simple-settings-we-can-run-now-from-the-command-line" class="anchor" href="#now-we-are-finished-with-our-simple-settings-we-can-run-now-from-the-command-line" aria-hidden="true"><span class="octicon octicon-link"></span></a>Now, we are finished with our simple settings, we can run now from the command line!</h3>

<pre><code># java -jar easy.pacs-0.0.1-SNAPSHOT.jar
</code></pre>

<p>THAT IS IT!</p>

<blockquote>
<p>Make sure that your database connection string is right, otherwise it will give hibernate error!</p>
</blockquote>

<ul>
<li>Go now to  <em><strong>http://localhost:8085</strong></em>  You will see such a screen:</li>
</ul>

<p><a href="https://2kere2beseder.files.wordpress.com/2015/04/homepage.jpg"><img src="https://2kere2beseder.files.wordpress.com/2015/04/homepage.jpg" alt="EasyPACS Home Page"></a></p>

<h3>
<a id="lets-send-some-dicom-files-to-the-server" class="anchor" href="#lets-send-some-dicom-files-to-the-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Let's send some dicom files to the server</h3>

<p>Our server is listening on port 104 with any name of AE Title on the localhost. We can now send dicom files to the server. </p>

<p>Please download the latest version of <a href="http://sourceforge.net/projects/dcm4che/files/dcm4che3/">dcm4che3</a> toolkit. 
Unzip it in your disk and go to the bin directory. Use it as shown below:</p>

<pre><code># storescu -c WHATEVER@localhost:104 "C:\dcmsamples\MARTIN^ZANE^"\*
</code></pre>

<p>It means you send the dicom files of <strong>MARTIN^ZANE^</strong> to the AE Title <em><strong>WHATEVER</strong></em> [it can be any name because we setup AE Title as star], to the port <em><strong>104</strong></em> on <em><strong>localhost</strong></em> (you can write your ip if you send remotely)</p>

<p>Below is the screenshot that shows how it is used on console</p>

<p><a href="https://2kere2beseder.files.wordpress.com/2015/04/storescu.jpg"><img src="https://2kere2beseder.files.wordpress.com/2015/04/storescu.jpg" alt="storescu command"></a></p>

<blockquote>
<p>If you need sample dcm files, here you can download the test dcm files of <a href="https://s3-us-west-2.amazonaws.com/easypacs/MARTIN%5EZANE%5E.zip">MARTIN^ZANE^</a>. Don't worry about the HIPAA rules, it is just a test patient file.</p>
</blockquote>

<p>Our server receives the incoming dicom files and starts to create the entities. This is the server page that lists the received patients. In this page, you will see the monitor messages as well that indicates the incoming patient transfers. </p>

<p>Patient MARTIN^ZANE^ has been received, the images will append per dicom request</p>

<p><a href="https://2kere2beseder.files.wordpress.com/2015/04/server.jpg"><img src="https://2kere2beseder.files.wordpress.com/2015/04/server.jpg" alt="Server Page"></a></p>

<p>And finally, this is the patient page that lists the latest study, series and images (instances). Remember that dicom files are saved on tmp\dcm and images are saved on tmp\img. The images are populated in real time based on existence of dicom files. So, as long as the the dicom files are there, the images will be shown per page load that means deleting jpeg images won't effect the system.</p>

<p><a href="https://2kere2beseder.files.wordpress.com/2015/04/patient2.jpg"><img src="https://2kere2beseder.files.wordpress.com/2015/04/patient2.jpg" alt="Patient"></a></p>

<p>You can click the dicom thumbnail image and view in bigger mode </p>

<p><a href="https://2kere2beseder.files.wordpress.com/2015/04/zoom.jpg"><img src="https://2kere2beseder.files.wordpress.com/2015/04/zoom.jpg" alt="view image"></a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/mehmetsen80/EasyPACS">Easy PACS</a> is maintained by <a href="https://github.com/mehmetsen80">mehmetsen80</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-26578001-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>

